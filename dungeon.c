/*

 cl65 -t pet -v -o dungeonPET.prg dungeon.c && xpet dungeonPET.prg > /dev/null
 cl65 -t c64 -v -o dungeon64.prg dungeon.c && x64sc dungeon64.prg > /dev/null

*/

#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <stdbool.h>
#include <unistd.h>
#include <string.h>

#if defined (__CC65__)
#include<cc65.h>
#include <conio.h>

#if defined __CBM__
    #include <cbm.h>
    #include <peekpoke.h>
#endif
#endif



#define VIC_BASE_RAM			(0x8000)
#define SCREEN_RAM				((char*)VIC_BASE_RAM+0x0400)
#define CHARMAP_RAM				((char*)VIC_BASE_RAM+0x0800)
#define SCREEN_WIDTH			40
#define SCREEN_HEIGHT			25
#define COLOR_OFFSET			(int)(COLOUR_RAM - SCREEN_RAM)
#define CHARS_RAM			    0x80
#define CHAR_SPACE				0x20
#define RAM_BLOCK				(CHARS_RAM + CHAR_SPACE)
#define CHARMAP_DEST			(RAM_BLOCK + 1)

// Global key variable
bool run=true;
bool in_play=false;
bool obstruction=false;
unsigned int timer,delay;
unsigned int key,i,c;
unsigned char x=19;
unsigned char y=8;
unsigned char old_x, old_y, direction_x, direction_y, fx, fy;
unsigned char room=0;
unsigned char buffer [sizeof(int)*8+1];

// Player 
unsigned char keys,idols,potion=0;
int health=100;
int magic=0;
unsigned int score=0;
bool sword = false;

// Enemy
unsigned int enemy_count=0;
struct enemy {
    unsigned char tile;
    unsigned char room;
    unsigned char x;
    unsigned char y;
    unsigned char old_x;
    unsigned char old_y;
    char health;
    unsigned char strength;
    unsigned char speed;
    unsigned char armour;
};
unsigned int this_enemy = 0;

struct enemy enemies[1000];


#ifdef __PET__
unsigned char title_screen_data[] = {
 32, 32, 32, 32, 32, 32,116, 98, 98,123, 98, 98,108, 98,123, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116, 97, 32, 97, 97, 32, 32, 97, 32,102,102, 92, 92, 92, 92, 32, 92,102, 92,102, 92,102, 92, 92, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116, 97, 32, 97, 97, 32, 32, 97, 32,102, 32, 92, 92, 92,102, 32, 92, 92, 32, 92, 32, 92, 92,102, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116, 98, 98, 97,121,121, 32, 97, 32,102, 32, 92, 92, 92, 92, 92, 92, 92, 92,102, 32, 92, 92, 92, 92, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116, 97, 32, 32, 97, 32, 32, 97, 32,102, 32, 92, 92, 92, 92,102, 92, 92, 92, 92, 32, 92, 92, 92,102, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116, 97, 32, 32, 97, 32, 32, 97, 32,102,102, 92,102, 92, 92, 32, 92,102, 92,102, 92,102, 92, 92, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,116,126, 32, 32,120,120, 32,126, 32,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,120,120,120,120,120,120,120,120,120,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 23,  5, 12,  3, 15, 13,  5, 32,  1,  4, 22,  5, 14, 20, 21, 18,  5, 18, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 25, 15, 21, 18, 32, 13,  9, 19, 19,  9, 15, 14, 32,  9, 19, 58, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32, 18,  5,  3, 15, 22,  5, 18, 32, 20,  8,  5, 32,  9,  4, 15, 12, 19, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32,  7,  5, 20, 32, 15, 21, 20, 32,  1, 12,  9, 22,  5, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32,  1, 14, 25, 32, 12, 15, 15, 20, 32, 25, 15, 21, 32,  6,  9, 14,  4, 32,  9, 19, 32, 25, 15, 21, 18, 19, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32,  2, 25, 32,  3,  8, 18,  9, 19, 32,  7,  1, 18, 18,  5, 20, 20, 32, 50, 48, 50, 51, 32, 21, 19,  9, 14,  7, 32,  3,  3, 54, 53, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32
};
#endif

#ifdef __C64__

    unsigned char chars[]={
            0x5C,0x57,0xE9,0x59,0x39,0x1E,0x14,0x36,
    0x10,0x28,0x28,0x44,0x7C,0x44,0xEE,0x00,
    0xFC,0x42,0x42,0x7C,0x42,0x42,0xFC,0x00,
    0x38,0x44,0x82,0x80,0x82,0x44,0x38,0x00,
    0xFC,0x42,0x42,0x42,0x42,0x42,0xFC,0x00,
    0xFE,0x42,0x48,0x78,0x48,0x42,0xFE,0x00,
    0xFE,0x42,0x48,0x78,0x48,0x40,0xE0,0x00,
    0x3C,0x42,0x80,0x8E,0x82,0x42,0x3C,0x00,
    0xEE,0x44,0x7C,0x44,0x44,0x44,0xEE,0x00,
    0xFE,0x10,0x10,0x10,0x10,0x10,0xFE,0x00,
    0x7C,0x10,0x10,0x10,0x90,0x90,0x60,0x00,
    0xEE,0x44,0x48,0x70,0x48,0x44,0xEE,0x00,
    0xE0,0x40,0x40,0x40,0x42,0x42,0xFE,0x00,
    0xEE,0x54,0x54,0x54,0x44,0x44,0xEE,0x00,
    0xEE,0x64,0x54,0x54,0x4C,0x4C,0xE4,0x00,
    0x38,0x44,0x82,0x82,0x82,0x44,0x38,0x00,
    0xFC,0x42,0x42,0x42,0x7C,0x40,0xE0,0x00,
    0x38,0x44,0x82,0x82,0x92,0x4C,0x3A,0x00,
    0xFC,0x42,0x42,0x42,0x7C,0x48,0xEE,0x00,
    0x7C,0x82,0x80,0x7C,0x02,0x82,0x7C,0x00,
    0xFE,0x92,0x10,0x10,0x10,0x10,0x38,0x00,
    0xEE,0x44,0x44,0x44,0x44,0x44,0x38,0x00,
    0xEE,0x44,0x44,0x28,0x28,0x28,0x10,0x00,
    0xEE,0x44,0x44,0x54,0x54,0x6C,0x44,0x00,
    0xEE,0x44,0x28,0x10,0x28,0x44,0xEE,0x00,
    0xEE,0x44,0x28,0x28,0x10,0x10,0x38,0x00,
    0xFE,0x84,0x08,0x10,0x20,0x42,0xFE,0x00,
    0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00,
    0x0C,0x12,0x30,0x7C,0x30,0x62,0xFC,0x00,
    0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00,
    0x00,0x18,0x3C,0x7E,0x18,0x18,0x18,0x18,
    0x00,0x10,0x30,0x7F,0x7F,0x30,0x10,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x18,0x18,0x18,0x18,0x00,0x00,0x18,0x00,
    0x66,0x66,0x66,0x00,0x00,0x00,0x00,0x00,
    0xFE,0xD4,0xAA,0xD4,0xAA,0xD4,0xAA,0x00,
    0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00,
    0x00,0x00,0x70,0x5E,0x72,0x00,0x00,0x00,
    0x08,0x94,0x48,0x2E,0x1A,0x24,0x6C,0x00,
    0x06,0x0C,0x18,0x00,0x00,0x00,0x00,0x00,
    0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00,
    0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00,
    0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00,
    0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30,
    0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,
    0x00,0x03,0x06,0x0C,0x18,0x30,0x60,0x00,
    0x38,0x44,0x82,0x82,0x82,0x44,0x38,0x00,
    0x30,0x50,0x90,0x10,0x10,0x10,0xFE,0x00,
    0x7C,0x82,0x02,0x7C,0x80,0x82,0xFE,0x00,
    0xFE,0x84,0x08,0x1C,0x82,0x82,0x7C,0x00,
    0x0C,0x18,0x28,0x4A,0xFE,0x0A,0x1C,0x00,
    0xFE,0x82,0xFC,0x02,0x82,0x82,0x7C,0x00,
    0x7C,0x82,0x80,0xFC,0x82,0x82,0x7C,0x00,
    0xFE,0x84,0x08,0x08,0x10,0x10,0x38,0x00,
    0x7C,0x82,0x82,0x7C,0x82,0x82,0x7C,0x00,
    0x7C,0x82,0x82,0x82,0x7C,0x04,0x78,0x00,
    0x00,0x00,0x18,0x00,0x00,0x18,0x00,0x00,
    0x00,0x00,0x18,0x00,0x00,0x18,0x18,0x30,
    0x00,0x7E,0x00,0x3C,0x00,0x18,0x00,0x00,
    0xEF,0x8A,0x0C,0x00,0xFE,0xAA,0x80,0x00,
    0x00,0x00,0x18,0x00,0x3C,0x00,0x7E,0x00,
    0x00,0x3C,0x7E,0xFE,0x7A,0x7E,0xFE,0x7E,
    0x00,0x3C,0x7E,0xFE,0x7A,0x7E,0xFE,0x7E,
    0x08,0x1C,0x3E,0x7F,0x7F,0x1C,0x3E,0x00,
    0x00,0x7E,0xDE,0xFE,0xFE,0xFE,0x7E,0x14,
    0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
    0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
    0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,
    0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,
    0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,
    0x00,0x00,0x00,0xE0,0xF0,0x38,0x18,0x18,
    0x18,0x18,0x1C,0x0F,0x07,0x00,0x00,0x00,
    0x18,0x18,0x38,0xF0,0xE0,0x00,0x00,0x00,
    0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,
    0xC0,0xE0,0x70,0x38,0x1C,0x0E,0x07,0x03,
    0x03,0x07,0x0E,0x1C,0x38,0x70,0xE0,0xC0,
    0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
    0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,
    0x08,0x18,0x99,0x7E,0x3C,0x3C,0x66,0x81,
    0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
    0x36,0x7F,0x6B,0x63,0x2A,0x1C,0x08,0x00,
    0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x60,
    0x00,0x00,0x00,0x07,0x0F,0x1C,0x18,0x18,
    0xC3,0xE7,0x7E,0x3C,0x3C,0x7E,0xE7,0xC3,
    0x00,0x3C,0x7E,0x66,0x66,0x7E,0x3C,0x00,
    0x18,0x3C,0x72,0x62,0x24,0x18,0x3C,0x00,
    0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,
    0x08,0x1C,0x3E,0x7F,0x3E,0x1C,0x08,0x00,
    0x18,0x18,0x18,0xFF,0xFF,0x18,0x18,0x18,
    0xC0,0xC0,0x30,0x30,0xC0,0xC0,0x30,0x30,
    0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
    0x00,0x0C,0x02,0x02,0x2C,0x7C,0xEC,0x00,
    0xFF,0x7F,0x3F,0x1F,0x0F,0x07,0x03,0x01,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,
    0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
    0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
    0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
    0xCC,0x87,0x30,0x66,0x08,0x93,0xC7,0x46,
    0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
    0x00,0x00,0x00,0x00,0xCC,0xCC,0x33,0x33,
    0xFF,0xFE,0xFC,0xF8,0xF0,0xE0,0xC0,0x80,
    0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
    0x18,0x18,0x18,0x1F,0x1F,0x18,0x18,0x18,
    0x00,0x00,0x00,0x00,0x0F,0x0F,0x0F,0x0F,
    0x18,0x18,0x18,0x1F,0x1F,0x00,0x00,0x00,
    0x00,0x00,0x00,0xF8,0xF8,0x18,0x18,0x18,
    0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
    0x00,0x00,0x00,0x1F,0x1F,0x18,0x18,0x18,
    0x18,0x18,0x18,0xFF,0xFF,0x00,0x00,0x00,
    0x00,0x00,0x00,0xFF,0xFF,0x18,0x18,0x18,
    0x18,0x18,0x18,0xF8,0xF8,0x18,0x18,0x18,
    0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
    0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
    0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
    0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
    0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,
    0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,
    0x00,0x00,0x00,0x00,0xF0,0xF0,0xF0,0xF0,
    0x0F,0x0F,0x0F,0x0F,0x00,0x00,0x00,0x00,
    0x18,0x18,0x18,0xF8,0xF8,0x00,0x00,0x00,
    0xF0,0xF0,0xF0,0xF0,0x00,0x00,0x00,0x00,
    0xF0,0xF0,0xF0,0xF0,0x0F,0x0F,0x0F,0x0F,
    0xC3,0x99,0x91,0x91,0x9F,0x99,0xC3,0xFF,
    0xE7,0xC3,0x99,0x81,0x99,0x99,0x99,0xFF,
    0x83,0x99,0x99,0x83,0x99,0x99,0x83,0xFF,
    0xC3,0x99,0x9F,0x9F,0x9F,0x99,0xC3,0xFF,
    0x87,0x93,0x99,0x99,0x99,0x93,0x87,0xFF,
    0x81,0x9F,0x9F,0x87,0x9F,0x9F,0x81,0xFF,
    0x81,0x9F,0x9F,0x87,0x9F,0x9F,0x9F,0xFF,
    0xC3,0x99,0x9F,0x91,0x99,0x99,0xC3,0xFF,
    0x99,0x99,0x99,0x81,0x99,0x99,0x99,0xFF,
    0xC3,0xE7,0xE7,0xE7,0xE7,0xE7,0xC3,0xFF,
    0xE1,0xF3,0xF3,0xF3,0xF3,0x93,0xC7,0xFF,
    0x99,0x93,0x87,0x8F,0x87,0x93,0x99,0xFF,
    0x9F,0x9F,0x9F,0x9F,0x9F,0x9F,0x81,0xFF,
    0x9C,0x88,0x80,0x94,0x9C,0x9C,0x9C,0xFF,
    0x99,0x89,0x81,0x81,0x91,0x99,0x99,0xFF,
    0xC3,0x99,0x99,0x99,0x99,0x99,0xC3,0xFF,
    0x83,0x99,0x99,0x83,0x9F,0x9F,0x9F,0xFF,
    0xC3,0x99,0x99,0x99,0x99,0xC3,0xF1,0xFF,
    0x83,0x99,0x99,0x83,0x87,0x93,0x99,0xFF,
    0xC3,0x99,0x9F,0xC3,0xF9,0x99,0xC3,0xFF,
    0x81,0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,0xFF,
    0x99,0x99,0x99,0x99,0x99,0x99,0xC3,0xFF,
    0x99,0x99,0x99,0x99,0x99,0xC3,0xE7,0xFF,
    0x9C,0x9C,0x9C,0x94,0x80,0x88,0x9C,0xFF,
    0x99,0x99,0xC3,0xE7,0xC3,0x99,0x99,0xFF,
    0x99,0x99,0x99,0xC3,0xE7,0xE7,0xE7,0xFF,
    0x81,0xF9,0xF3,0xE7,0xCF,0x9F,0x81,0xFF,
    0xC3,0xCF,0xCF,0xCF,0xCF,0xCF,0xC3,0xFF,
    0xF3,0xED,0xCF,0x83,0xCF,0x9D,0x03,0xFF,
    0xC3,0xF3,0xF3,0xF3,0xF3,0xF3,0xC3,0xFF,
    0xFF,0xE7,0xC3,0x81,0xE7,0xE7,0xE7,0xE7,
    0xFF,0xEF,0xCF,0x80,0x80,0xCF,0xEF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xE7,0xE7,0xE7,0xE7,0xFF,0xFF,0xE7,0xFF,
    0x99,0x99,0x99,0xFF,0xFF,0xFF,0xFF,0xFF,
    0x99,0x99,0x00,0x99,0x00,0x99,0x99,0xFF,
    0xE7,0xC1,0x9F,0xC3,0xF9,0x83,0xE7,0xFF,
    0x9D,0x99,0xF3,0xE7,0xCF,0x99,0xB9,0xFF,
    0xC3,0x99,0xC3,0xC7,0x98,0x99,0xC0,0xFF,
    0xF9,0xF3,0xE7,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xF3,0xE7,0xCF,0xCF,0xCF,0xE7,0xF3,0xFF,
    0xCF,0xE7,0xF3,0xF3,0xF3,0xE7,0xCF,0xFF,
    0xFF,0x99,0xC3,0x00,0xC3,0x99,0xFF,0xFF,
    0xFF,0xE7,0xE7,0x81,0xE7,0xE7,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xE7,0xE7,0xCF,
    0xFF,0xFF,0xFF,0x81,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xE7,0xE7,0xFF,
    0xFF,0xFC,0xF9,0xF3,0xE7,0xCF,0x9F,0xFF,
    0xC3,0x99,0x91,0x89,0x99,0x99,0xC3,0xFF,
    0xE7,0xE7,0xC7,0xE7,0xE7,0xE7,0x81,0xFF,
    0xC3,0x99,0xF9,0xF3,0xCF,0x9F,0x81,0xFF,
    0xC3,0x99,0xF9,0xE3,0xF9,0x99,0xC3,0xFF,
    0xF9,0xF1,0xE1,0x99,0x80,0xF9,0xF9,0xFF,
    0x81,0x9F,0x83,0xF9,0xF9,0x99,0xC3,0xFF,
    0xC3,0x99,0x9F,0x83,0x99,0x99,0xC3,0xFF,
    0x81,0x99,0xF3,0xE7,0xE7,0xE7,0xE7,0xFF,
    0xC3,0x99,0x99,0xC3,0x99,0x99,0xC3,0xFF,
    0xC3,0x99,0x99,0xC1,0xF9,0x99,0xC3,0xFF,
    0xFF,0xFF,0xE7,0xFF,0xFF,0xE7,0xFF,0xFF,
    0xFF,0xFF,0xE7,0xFF,0xFF,0xE7,0xE7,0xCF,
    0xF1,0xE7,0xCF,0x9F,0xCF,0xE7,0xF1,0xFF,
    0xFF,0xFF,0x81,0xFF,0x81,0xFF,0xFF,0xFF,
    0x8F,0xE7,0xF3,0xF9,0xF3,0xE7,0x8F,0xFF,
    0xC3,0x99,0xF9,0xF3,0xE7,0xFF,0xE7,0xFF,
    0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,
    0xF7,0xE3,0xC1,0x80,0x80,0xE3,0xC1,0xFF,
    0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,
    0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,
    0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
    0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,
    0xCF,0xCF,0xCF,0xCF,0xCF,0xCF,0xCF,0xCF,
    0xF3,0xF3,0xF3,0xF3,0xF3,0xF3,0xF3,0xF3,
    0xFF,0xFF,0xFF,0x1F,0x0F,0xC7,0xE7,0xE7,
    0xE7,0xE7,0xE3,0xF0,0xF8,0xFF,0xFF,0xFF,
    0xE7,0xE7,0xC7,0x0F,0x1F,0xFF,0xFF,0xFF,
    0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x00,0x00,
    0x3F,0x1F,0x8F,0xC7,0xE3,0xF1,0xF8,0xFC,
    0xFC,0xF8,0xF1,0xE3,0xC7,0x8F,0x1F,0x3F,
    0x00,0x00,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,
    0x00,0x00,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,
    0xFF,0xC3,0x81,0x81,0x81,0x81,0xC3,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,
    0xC9,0x80,0x80,0x80,0xC1,0xE3,0xF7,0xFF,
    0x9F,0x9F,0x9F,0x9F,0x9F,0x9F,0x9F,0x9F,
    0xFF,0xFF,0xFF,0xF8,0xF0,0xE3,0xE7,0xE7,
    0x3C,0x18,0x81,0xC3,0xC3,0x81,0x18,0x3C,
    0xFF,0xC3,0x81,0x99,0x99,0x81,0xC3,0xFF,
    0xE7,0xE7,0x99,0x99,0xE7,0xE7,0xC3,0xFF,
    0xF9,0xF9,0xF9,0xF9,0xF9,0xF9,0xF9,0xF9,
    0xF7,0xE3,0xC1,0x80,0xC1,0xE3,0xF7,0xFF,
    0xE7,0xE7,0xE7,0x00,0x00,0xE7,0xE7,0xE7,
    0x3F,0x3F,0xCF,0xCF,0x3F,0x3F,0xCF,0xCF,
    0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,0xE7,
    0xFF,0xFF,0xFC,0xC1,0x89,0xC9,0xC9,0xFF,
    0x00,0x80,0xC0,0xE0,0xF0,0xF8,0xFC,0xFE,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,
    0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
    0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,
    0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,
    0x33,0x33,0xCC,0xCC,0x33,0x33,0xCC,0xCC,
    0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,
    0xFF,0xFF,0xFF,0xFF,0x33,0x33,0xCC,0xCC,
    0x00,0x01,0x03,0x07,0x0F,0x1F,0x3F,0x7F,
    0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,
    0xE7,0xE7,0xE7,0xE0,0xE0,0xE7,0xE7,0xE7,
    0xFF,0xFF,0xFF,0xFF,0xF0,0xF0,0xF0,0xF0,
    0xE7,0xE7,0xE7,0xE0,0xE0,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0x07,0x07,0xE7,0xE7,0xE7,
    0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
    0xFF,0xFF,0xFF,0xE0,0xE0,0xE7,0xE7,0xE7,
    0xE7,0xE7,0xE7,0x00,0x00,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0x00,0x00,0xE7,0xE7,0xE7,
    0xE7,0xE7,0xE7,0x07,0x07,0xE7,0xE7,0xE7,
    0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,
    0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,
    0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,
    0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
    0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0x00,0x00,
    0xFF,0xFF,0xFF,0xFF,0x0F,0x0F,0x0F,0x0F,
    0xF0,0xF0,0xF0,0xF0,0xFF,0xFF,0xFF,0xFF,
    0xE7,0xE7,0xE7,0x07,0x07,0xFF,0xFF,0xFF,
    0x0F,0x0F,0x0F,0x0F,0xFF,0xFF,0xFF,0xFF,
    0x0F,0x0F,0x0F,0x0F,0xF0,0xF0,0xF0,0xF0

    };

unsigned char title_screen_data[] = {
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,236,251, 32,236,226, 32, 97,123, 32,102,102, 92, 92, 92, 92, 32, 92,102, 92,102, 92,102, 92, 92, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 97, 32, 32, 97, 32, 32, 97, 97, 32,102, 32, 92, 92, 92,102, 32, 92, 92, 32, 92, 32, 92, 92,102, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 97, 32, 32,236,251, 32,252,252,123,102, 32, 92, 92, 92, 92, 92, 92, 92, 92,102, 32, 92, 92, 92, 92, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 97, 32, 32, 97,225, 32, 32, 97, 32,102, 32, 92, 92, 92, 92,102, 92, 92, 92, 92, 32, 92, 92, 92,102, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32,252,254, 32,252,254, 32, 32, 97, 32,102,102, 92,102, 92, 92, 32, 92,102, 92,102, 92,102, 92, 92, 32, 92, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104,104, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 23,  5, 12,  3, 15, 13,  5, 32,  1,  4, 22,  5, 14, 20, 21, 18,  5, 18, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 25, 15, 21, 18, 32, 13,  9, 19, 19,  9, 15, 14, 32,  9, 19, 58, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32, 18,  5,  3, 15, 22,  5, 18, 32, 20,  8,  5, 32,  9,  4, 15, 12, 19, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32,  7,  5, 20, 32, 15, 21, 20, 32,  1, 12,  9, 22,  5, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 90, 32,  1, 14, 25, 32, 12, 15, 15, 20, 32, 25, 15, 21, 32,  6,  9, 14,  4, 32,  9, 19, 32, 25, 15, 21, 18, 19, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32,  2, 25, 32,  3,  8, 18,  9, 19, 32,  7,  1, 18, 18,  5, 20, 20, 32, 50, 48, 50, 51, 32, 21, 19,  9, 14,  7, 32,  3,  3, 54, 53, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32
};

unsigned char title_screen_cdata[] = {
  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 13,  5, 13, 13, 13, 13,  5, 13, 13,  5, 13,  5, 13, 13, 13,  5, 13,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 13,  5, 13, 13, 13, 13, 13, 13, 13, 13, 13,  5, 13, 13, 13, 13, 13,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5,  5, 13,  5, 13, 13,  5,  5,  5,  5, 13, 13,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,  5,  5,  5,  5, 13, 13,  5, 13,  5,  5,  5,  5, 13, 13,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5, 10, 10, 10, 10, 10, 10, 10,  5, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  2,  2,  2,  2,  5,  2,  2,  2,  2,  2,  2,  2,  5,  2,  2, 11,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  3,  5, 15, 15, 15, 15, 15, 15, 15,  5, 15, 15, 15,  5, 15, 15, 15, 15, 15,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5, 14,  5, 12, 12, 12,  5, 12, 12, 12,  5, 12, 12, 12, 12, 12,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  6,  5, 11, 11, 11,  5, 11, 11, 11, 11,  5, 11, 11, 11,  5, 11, 11, 11, 11,  5, 11, 11,  5, 11, 11, 11, 11, 11,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5, 12, 12,  5, 15, 15, 15, 15, 15,  5, 15, 15, 15, 15, 15, 15, 15,  5, 12, 12, 12, 12,  5, 11, 11, 11, 11, 11,  5, 15, 15, 15, 15,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5
};


#endif

unsigned char rooms[] = {
// Room 1
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 0, 32, 32, 32, 32, 32, 11, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 94, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,  9, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 81, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 88, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 83, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102,102,102,102,102, 45,102,102,102,102,102,102,102,102,102, 32, 32, 32, 32, 32, 83, 32,102, 32, 32, 32, 32, 32, 32,
 32,102,102,102,102,102,102,102,102,102,102,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 36, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 11, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 83, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 11, 32, 32, 32, 32, 32,  9, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 30, 32, 88, 32, 32, 32, 32,  9, 32, 32, 32, 32, 38, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 94, 32, 32, 32, 32,102, 32, 32, 94, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 36, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32,102,102,102,102,102,102,102,102,102,102,102, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32, 32,102, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32
,// room 2
 
 105,120,120,120,120,120,120,120, 66, 61, 61, 66,120,120,120,120,120,120,120, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 97, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 97, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
117, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 97, 32, 32, 32, 32, 32, 32, 32, 32,  0, 32, 32, 32, 32, 32, 32, 32, 32, 32,116, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,121, 98, 98, 98, 98, 98, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 97, 32, 32, 90, 32, 94, 94, 94, 94, 94, 94, 94, 94, 94, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32,127, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98,117,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,117,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
117, 32, 32, 32, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,116, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 88, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 32, 90, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 83, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 83, 32, 32, 32, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 32, 90, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 88, 32, 32, 32, 32, 32, 32, 97,117, 32, 32, 32, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,116,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,117, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 97, 32, 32, 32, 32, 32, 32, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98, 98,117, 97, 32, 32, 90, 32, 94, 94, 94, 94, 94, 94, 94, 94, 94, 32, 32, 32, 32, 32, 97,
127, 98, 98, 98, 98, 98, 98,117, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,116,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,117, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 32, 32, 32, 32, 32, 32, 32, 66, 61, 61, 66, 32, 32, 32, 32, 32, 32, 32, 97,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,105,120,120,120,120,120,120,120, 66, 61, 61, 66,120,120,120,120,120,120,120, 97,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32
 
 // room 3
 ,
  
   32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 87, 87, 87, 87, 32, 87, 87, 87, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 87, 87, 32, 32, 87, 87, 87, 87, 32, 32, 32, 32, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 87, 87, 87, 87, 87, 87, 87, 87, 87, 87, 87, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 87, 32, 32, 32, 32, 32, 32,
 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 32, 32, 32, 32, 88, 83, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32,
 32, 87, 32, 32, 32, 88, 32, 32, 32, 32, 32, 32, 32, 32, 32,  9, 32, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 87, 32, 87, 32, 32, 32, 32, 32,
 32, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 87, 87, 32, 32, 38, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 87, 87, 32, 32, 32, 32,
 32, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 32, 32, 32, 87, 32, 32, 32, 32,
 32, 87, 32, 32, 32, 32, 32, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32,
 32, 87, 87, 32, 32, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 32, 32, 32, 32, 87, 45, 87, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 32,
 32, 32, 87, 32, 32, 32, 38, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 87, 87, 32, 32, 32, 94, 94, 94, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 32, 32, 94, 94, 94, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 32, 32, 87, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,  9, 32, 32, 32, 94, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 87, 87, 87, 87, 87, 32, 32, 32, 32, 32, 87, 32, 32, 94, 32, 32, 32, 32, 32, 32,  0, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 87, 87, 87, 87, 87, 32, 94, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 87, 32, 32, 32, 32, 32, 87, 87, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 87, 87, 87, 87, 87, 87, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32

};

unsigned char game_map[1000];

unsigned int map(char x, char y) {
    
    unsigned char c;

    c = game_map[40*y+x];
    if(c>64) c+=64;
    return c;
    
    // For testing you could use the following to output the charset
    // return 40*y+x;
}

void load_room() {
    int pos;

    clrscr();
    gotoxy(0,0);
    printf("loading room %d",room+1);

    for (pos = 0; pos < 1000; pos++) {   

        c=rooms[pos+(1000*room)];

        // Player x and y
        if(c==0) {
            y=pos/40;
            x=pos % 40;
        }

        // Goblin
        if(c==38) {

            // Increment for next enemy (Enemy 0 is counted as no enemy)
            enemy_count+=1;

            // Create the enemy in the list
            enemies[enemy_count].tile = c;
            enemies[enemy_count].room = room;
            enemies[enemy_count].x = pos % 40;
            enemies[enemy_count].y = pos/40;
            enemies[enemy_count].old_x = enemies[enemy_count].x;
            enemies[enemy_count].old_y = enemies[enemy_count].y;
            enemies[enemy_count].health = 30;
            enemies[enemy_count].strength = 5;
            enemies[enemy_count].speed = 1;
            enemies[enemy_count].armour = 10;

        }  

        // Rat
        else if (c==94) {

            // Increment for next enemy (Enemy 0 is counted as no enemy)
            enemy_count+=1;

            // Create the enemy in the list
            enemies[enemy_count].tile = 158;
            enemies[enemy_count].room = room;
            enemies[enemy_count].x = pos % 40;
            enemies[enemy_count].y = pos/40;
            enemies[enemy_count].old_x = enemies[enemy_count].x;
            enemies[enemy_count].old_y = enemies[enemy_count].y;
            enemies[enemy_count].health = 15;
            enemies[enemy_count].strength = 5;
            enemies[enemy_count].speed = 2;
            enemies[enemy_count].armour = 0;

        }  

        game_map[pos] = c;     
    }
    
    /*
    printf("\n\nenemies %3d\n", enemy_count);
    for(i=1; i<enemy_count+1;i++)
    {
        printf("%s %3d\n",enemies[i].tile,i);
    }

    key = cgetc();      
    */
}

void set_map(char x, char y, int tile) {
    
    // Set the part of the array to the given tile
    game_map[40*y+x]=tile;
    
}



unsigned int dumb_wait(unsigned int delay) {
    for(timer=0; timer<delay; timer++) {}
    return timer;
}

// Returns the enemy for a given x,y coord
unsigned int which_enemy(ex,ey) {

    if(map(ex,ey)==32) return 0;

    // Enemies starts at 1, 0 = no enemy
    for(i=1;i<enemy_count+1;i++)
    {
        if(enemies[i].x == ex && enemies[i].y == ey && enemies[i].health >= 1) return i;
       
    }

    // No enemies
    return 0;

}


void attack(weapon, ax, ay)
{
    int rnum = 0;
    this_enemy = 0;
    this_enemy = which_enemy(ax,ay);
    if(this_enemy == 0) {
        return;
    } 

    rnum = (rand() % (20 - 1 + 1)) + 1; 

    if(rnum > enemies[this_enemy].armour+enemies[this_enemy].speed) {

        // Damage!
        if(enemies[this_enemy].health<weapon) 
        {
            enemies[this_enemy].health = 0;

        } else {
            enemies[this_enemy].health-=weapon;
        }    
        gotoxy(0,0);
        printf("hit!! enemy health: %3d    ", enemies[this_enemy].health);
        timer=dumb_wait(1000);
        
    } else {
        gotoxy(0,0);
        printf("miss! enemy health: %3d    ", enemies[this_enemy].health);
        if((x == ax && y == ay)||(x == ax && (y == ay + 1 || y == ay - 1)) || (y == ay && (x == ax + 1 || x == ax - 1))) 
        {
            health -= enemies[this_enemy].strength;
        }
        timer=dumb_wait(1000);
    }

    if(enemies[this_enemy].health < weapon) {

        // Success!
        gotoxy(0,0);
        printf("enemy defeated!                      ");
        
        // Draw tile in new location
        cputcxy(ax,ay,32); 
        set_map(ax,ay,32);
        enemies[this_enemy].tile = 32;
        // cputcxy(x,y,64);
        // Up the score
        score+=10;
        timer=dumb_wait(1000);
    }

}

void enemy_attack(this_enemy)
{
    int rnum = 0;
    rnum = (rand() % (20 - 1 + 1)) + 1; 

    if(rnum > 10) {

        // Damage!
        if(health < 1 || (health-enemies[this_enemy].strength) < 1) 
        {
            health = 0;

        } else {
            health-=enemies[this_enemy].strength;
        }    
        gotoxy(0,0);
        printf("ouch! health: %3d        ", health);
        timer=dumb_wait(1000);

        
    } else {
            enemies[this_enemy].health -= 5;
            if(enemies[this_enemy].health<1) {
               enemies[this_enemy].health=0;
                // Draw tile in new location
                cputcxy(enemies[this_enemy].x,enemies[this_enemy].y,32); 
                set_map(enemies[this_enemy].x,enemies[this_enemy].y,32);
                enemies[this_enemy].tile = 32;
                gotoxy(0,0);
                printf("enemy defeated!            ");
                
            }else {
                gotoxy(0,0);
                printf("block health: %3d      ", health);}
        }
        
        timer=dumb_wait(1000);
    

    if(health < 1) {

        // Fail!
        gotoxy(0,0);
        printf("enemy defeated you!                  ");
        health = 0;
        timer=dumb_wait(1000);
    }

}


// Move the enemies for a given room
void move_enemies() {

    unsigned char rnd;

    // Enemies starts at 1, 0 = no enemy
    for(i=1;i<enemy_count+1;i++)
    {
        if(enemies[i].room == room && enemies[i].health>0){
            
            enemies[i].old_x = enemies[i].x;
            enemies[i].old_y = enemies[i].y; 
            
            // Rat is random
            if(enemies[i].tile == 158) {
                rnd = (rand() % (4)) + 1; 
                if(rnd == 4) enemies[i].x-=1;
                if(rnd == 2) enemies[i].x+=1;
                if(rnd == 1) enemies[i].y-=1;
                if(rnd == 3) enemies[i].y+=1;
            }

            // Gobbo goes for player
            if(enemies[i].tile == 38) {
                if(enemies[i].x > x) enemies[i].x-=1;
                if(enemies[i].x < x) enemies[i].x+=1;
                if(enemies[i].y > y) enemies[i].y-=1;
                if(enemies[i].y < y) enemies[i].y+=1;
            }

            // Redraw
            c=map(enemies[i].x,enemies[i].y);
            if(c!=32) {
                enemies[i].x = enemies[i].old_x;
                enemies[i].y = enemies[i].old_y;
                if(c==64) enemy_attack(i);
            }else{
                set_map(enemies[i].old_x, enemies[i].old_y, 32);
                cputcxy(enemies[i].old_x, enemies[i].old_y, 32);
            }
            set_map(enemies[i].x, enemies[i].y, enemies[i].tile);
            cputcxy(enemies[i].x, enemies[i].y,enemies[i].tile);
            
        }
    }

}

void draw_screen() {

    int row,col;
    for(row=0; row<25; row++)
    {
        for(col=0; col < 40; col++){
            cputcxy(col,row,map(col,row));
        }
    };

}



void draw_momentary_object(obj_old_x, obj_old_y, obj_x, obj_y, obj_tile, delay) {

    // Replace tile
    cputcxy(obj_old_x,obj_old_y,map(obj_old_x,obj_old_y));

    // Draw tile in new location
    cputcxy(obj_x,obj_y,obj_tile); 

    // Delay
    timer=dumb_wait(delay);

    // Replace tile again
    cputcxy(obj_x,obj_y,map(obj_x,obj_y));
    
}


void draw_move(bool replace) {

    // Delete the player character
    if(!replace) {
        set_map(old_x, old_y, 32);
    }

    // Draw new location
    cputcxy(old_x,old_y,map(old_x,old_y));
    cputcxy(x,y,64); 
    set_map(x, y, 64);
}


#ifdef __PET__
void title_screen() {
    
    clrscr();

    for(i=0; i<1000; i++) {
      POKE(32768+i,title_screen_data[i]);
    }

    gotoxy(0,9);
    printf("    a game by retrogamecoders.com\n             press a key");

    while(kbhit()==false){
      timer=dumb_wait(1500);
      gotoxy(13,10);  
      printf("%cpress a key",18);  
      timer=dumb_wait(1500);
      gotoxy(13,10);  
      printf("%cpress a key",146);    
    };
    
    in_play=true;
}


#elif defined __C64__

void title_screen() {



    memcpy(0x3000,&chars,sizeof(chars)); // load character data into 3000
    POKE(53272,(PEEK(53272)&240)+12);
    clrscr();

    for(i=0; i<1000; i++) {
      POKE(1024+i,title_screen_data[i]);
      POKE(55296+i,title_screen_cdata[i]);
    }

    gotoxy(0,9);
    printf("    a game by retrogamecoders.com\n             press a key");
    key=cgetc();
    in_play=true;
}

#else
void title_screen() {
    
    clrscr();
    gotoxy(0,9);
    printf("    a game by retrogamecoders.com\n             press a key");
    key=cgetc();
    in_play=true;
}
#endif

bool game_over() {
    clrscr();
    printf("game over\n\n");
    timer=dumb_wait(1000);
    printf("ah, such a shame,\nyou were doing so well!\n\n");
    timer=dumb_wait(1000);
    printf("score:%03d\n\nplay again (y/n)?",score);
    key=cgetc();
    in_play=false;
    if(key=='n') {
        return false;
    } else {
        return true;
    }
}

void game_loop() {

    gotoxy(0,24);
    printf(" k: %02d S: %03d *: %03d score: %04d", keys,health, magic, score);

    // Change direction
    if(x != old_x || y != old_y) {
        direction_x = x-old_x;
        direction_y = y-old_y;
    }


    move_enemies();

    // Backup the location
    old_x = x;
    old_y = y;

    //if(kbhit()) { Remove comment to make more action than turn-based
        
        // Check keys;
        switch (key=cgetc()) 
        { 

            case 'w':
                if(y>0) y--; 
                break; 
            case 'a': 
                if(x>0) x--; 
                break; 
            case 'A': 
            case 'o':
                if(sword==true) {
                    draw_momentary_object(x-1,y,x-1,y,131,2000); 
                    attack(10,x-1,y);
                }
                break;     
            case 's': 
                if(y<24) y++; 
                break; 
            case 'd': 
                if(x<39) x++; 
                break; 
            case 'D': 
            case 'p':
                if(sword==true) {
                    draw_momentary_object(x+1,y,x+1,y,31,2000); 
                    attack(10,x+1,y);
                }
                break; 
            case 'f': 

                if(magic > 5) {

                    magic-=5;
                    fx = x+direction_x;
                    fy = y+direction_y;  

                    c=map(fx,fy);
                    while(c==32 && magic > 0) {             
                        draw_momentary_object(fx,fy,fx,fy,'*',200); 
                        magic-=1;
                        fx = fx+direction_x;
                        fy = fy+direction_y;  
                        c=map(fx,fy);
                    }

                    attack(10,fx,fy);

                }

                break;            
            case 'Q':
            case 3:
                in_play = false;
                break;
            default:
                // Figure out scan codes 
                //gotoxy(0,0);
                //printf("%d",key);
                break; 
        }
    //} Remove comment to make more action than turn-based

    gotoxy(0,0);
    printf("                              ");


    // Anything in our path?
    obstruction=false;
    c=map(x,y);
    
    // Collision
    switch (c)
    {
        case 166:
            // Wall               
            obstruction=true;
            break;
        
        case 11: // Key +1
            keys+=1;
            break;

        case 9:
        case 45:
            if(keys>0)
            {
                keys-=1;
                score+=5;
                obstruction=false;

            }else{

                // Not enough keys to unlock!
                set_map(x, y, 28); // turn into partially open
                health-=10; // lose 10 health
                obstruction=true;
            }
            break;

        case 28: // Partially open door

            if(keys>0)
            {
                keys-=1;
                score+=5;
                obstruction=false;

            }else{
                // Not enough keys to unlock!
                set_map(x, y, 32);  // turn into fully open
                health-=10;         // lose 10 health
                obstruction=true;
            }
            break;

        case 30: // Sword!
            sword=true;
            break;

        case 36: // Cash money
            score+=5;
            break;

        case 145: // Potion
            score+=15;
            magic+=100;
            break;

        case 154: // Cash money
            score+=15;
            break;

        case 147: // Health
            health+=25;
            if(health>100) health=100; // Can't be more than 100%!
            break;


/* Enemies >> */

        case 38: // Gobbo
            attack(5,x,y);
            obstruction=true;
            break;

        case 158: // Rats
        case 222:
            attack(5,x,y);
            obstruction=true;
            break;

/* ^^ Enemies */

        case 152: // Idol
            score+=10;
            idols+=1;
            if(idols==2) {
                room+=1;
                load_room();
                draw_screen();
                idols=0;
            }
            break;

        case 0:
        case 64: // Player
            break;
        
        default:
            
            // convert integer to ascii: itoa(c,buffer,10);
            
            if(c!=32) {
                // Figure out what the code is for tile
                //gotoxy(0,0);
                //printf("bumped into ...... %03d",c);
                obstruction=true;
            }
            
            break;
    }

    // If obstructed then bounce
    if(obstruction) {
        x=old_x;
        y=old_y;
    } else {
        draw_move(false);
    }

    if(health<1) {
        in_play = false;
    }

    
    
}


int main() {

    // Use current time as 
    // seed for random generator 
    srand(1); 

    /* Clear Screen */
    clrscr();

#ifdef __PET__
    // Uppercase/Graphical characterset = 12
    POKE(59468,12);
#endif

#ifdef __C64__

    // Screen colors back to black + black border
    POKE(53281,0);
    POKE(53280,0);

    // Text color to match PET
    POKE(646,5);

    // Uppercase/Graphical characterset
    POKE(53272,21);

#endif

    /* Hide cursor */
    cursor(0);

    // Titles
    title_screen();

    // Start running     
    run=true;
        
    // Should the program end?
    while(run){

        // Initialize if not already running a game
        if (in_play != true) {
            keys=0;
            health=100;
            score=0;
            keys=0;
            room=0;
            potion=0;
            magic=0;
            enemy_count=0;
            sword=false;
        }

        // Set up the screen
        load_room();
        draw_screen();
        cputcxy(x,y,'@');

        // Game on!
        in_play = true;

        /* Loop until game ends */
        while (in_play)
        {
            game_loop();
        }

        // Try again or quit?
        run=game_over();

    }
    clrscr();
    printf("goodbye!\n\n");
    cursor(1);
    return(0);
}
