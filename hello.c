#include <stdio.h>
#include <conio.h>
#include <cbm.h>
#include <peekpoke.h>

// Global key variable
char key;
char x=19;
char y=10;
char old_x, old_y;
char level=0;

char game_map[] = {
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,240,242,241,242,241,242,241,242,241,242, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,241, 32, 32, 32, 32, 32, 32, 32, 32,219, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,219, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,235, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,235, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,243, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,235, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241,241,241,241,241, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 93, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,242, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,235, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,241, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,219, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241,242,241, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32


};

char map(char level, char x, char y) {
    
    // Right now just one map
    return game_map[40*y+x];
}


void draw_screen() {

    int row,col;
    for(row=0; row<25; row++)
    {
        for(col=0; col < 40; col++){
            cputcxy(col,row,map(level,col,row));
        }
    };

}

int main() {
    /* Clear Screen */
    clrscr();
    POKE(59468,12);
    draw_screen();

    /* Hide cursor */
    cursor(0);
    printf("map 1");
    cputcxy(x,y,'@');

    /* Loop until Q is pressed */
    while ((key  = cgetc()) != 'Q')
    {


        // Delete the character
        cputcxy(x,y,map(level,x,y));

        // Backup the location
        old_x = x;
        old_y = y;

        // keys;
        switch (key) 
        { 
            case 'w':
                if(y>0) y--; 
                break; 
            case 'a': 
                if(x>0) x--; 
                break; 
            case 's': 
                if(y<24) y++; 
                break; 
            case 'd': 
                if(x<39) x++; 
                break; 
            default: 
                break; 
        }


        // Draw new location
        cputcxy(x,y,64);
     
    }
    cursor(1);
    return(0);
}
